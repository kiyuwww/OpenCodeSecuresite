<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Three-Step Secure Login</title>
  <style>
    :root{--bg:#111;--fg:#fff;--accent:#4CAF50}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    .center{display:flex;align-items:center;justify-content:center;height:100%}
    .card{width:420px;padding:28px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.4);background:linear-gradient(180deg,#0f1724, #0b1220);color:var(--fg)}
    h1{font-size:20px;margin:0 0 10px}
    p.lead{margin:0 0 18px;color:#9aa3b2}
    label{display:block;font-size:13px;margin-bottom:6px;color:#bfc9d6}
    input[type=text],input[type=password]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--fg);outline:none;font-size:14px}
    button{margin-top:12px;width:100%;padding:10px;border-radius:8px;border:0;background:#0ea5a4;color:#071018;font-weight:600;cursor:pointer}
    .small{font-size:12px;color:#8f9aa8;margin-top:8px}
    .hidden{display:none}
    /* final welcome style */
    .final-page{background:#000;color:#fff;padding:40px;border-radius:12px;text-align:center}
    .welcome{font-size:36px;font-weight:700;letter-spacing:1px}
    .subtitle{margin-top:8px;color:#cfd6dd}
  </style>
</head>
<body>
  <div id="stage" class="center">
    <div class="card" id="card">
      <h1>Step 1 — Авторизация</h1>
      <p class="lead">Введите логин и пароль, чтобы пройти на следующий шаг</p>

      <div id="form1">
        <label for="login1">Логин</label>
        <input id="login1" type="text" autocomplete="username">
        <label for="pass1">Пароль</label>
        <input id="pass1" type="password" autocomplete="current-password">
        <button id="btn1">Отправить</button>
        <div class="small">Если данные верны — фон станет зелёным и откроется следующий запрос</div>
      </div>

      <div id="form2" class="hidden">
        <h1>Step 2 — Второй ввод</h1>
        <label for="login2">Логин</label>
        <input id="login2" type="text">
        <label for="pass2">Пароль</label>
        <input id="pass2" type="password">
        <button id="btn2">Отправить</button>
      </div>

      <div id="form3" class="hidden">
        <h1>Step 3 — Последний ввод</h1>
        <label for="login3">Логин</label>
        <input id="login3" type="text">
        <label for="pass3">Пароль</label>
        <input id="pass3" type="password">
        <button id="btn3">Отправить</button>
      </div>

      <div id="message" class="small"></div>
    </div>
  </div>

  <script>
    // ====== Configuration (зашифрованные/хэшированные подписи) ======
    // Ключ HMAC (из Python генерации). Для безопасности поменяйте его перед использованием.
    const MASTER_KEY = 'embed_master_key_!ChangeMe';

    // Здесь хранятся подписи HMAC-SHA256 для пары "login:password" в Base64.
    // Эти значения были сгенерированы заранее. Сайт будет вычислять HMAC от введённых данных
    // и сравнивать с этими значениями — таким образом данные хранятся не в виде явного текста.
    const EXPECTED = {
      // step1
      'step1': 'VlkNn2VImD5NtyCMTsMVuWOIGpnFT1IqgyjuQUBw8d0=',
      // step2
      'step2': 'Y3TSylbXyAujuf9PDHMlEnfe25PuYO9HfTfxbfZtDaA=',
      // step3
      'step3': 'AMy+4hyov8B57aOwbaS2ctwy0HcX8qNi8DoU5HXMK1I='
    };

    // ====== Утилиты (Web Crypto) ======
    async function importKeyRaw(keyStr){
      const enc = new TextEncoder();
      return await crypto.subtle.importKey('raw', enc.encode(keyStr), {name:'HMAC', hash:'SHA-256'}, false, ['sign']);
    }

    async function hmacBase64(keyCrypto, message){
      const enc = new TextEncoder();
      const sig = await crypto.subtle.sign('HMAC', keyCrypto, enc.encode(message));
      return btoa(String.fromCharCode(...new Uint8Array(sig)));
    }

    function setBackgroundColor(color){
      document.body.style.background = color;
      document.getElementById('card').style.boxShadow = (color === 'green') ? '0 8px 30px rgba(6,95,70,0.25)' : '0 8px 30px rgba(255,0,0,0.15)';
    }

    function showMessage(text){
      document.getElementById('message').textContent = text;
    }

    // ====== Flow ======
    (async()=>{
      const key = await importKeyRaw(MASTER_KEY);

      // Helper to verify a step.
      async function verifyStep(login, pass, expectedBase64){
        const data = login + ':' + pass;
        const sig = await hmacBase64(key, data);
        // timing-safe compare
        if (sig.length !== expectedBase64.length) return false;
        let res = 0;
        for(let i=0;i<sig.length;i++) res |= sig.charCodeAt(i) ^ expectedBase64.charCodeAt(i);
        return res === 0;
      }

      // Step 1
      document.getElementById('btn1').addEventListener('click', async()=>{
        const l = document.getElementById('login1').value.trim();
        const p = document.getElementById('pass1').value;
        const ok = await verifyStep(l,p,EXPECTED.step1);
        if(ok){
          setBackgroundColor('#0b612a'); // красивый зелёный оттенок
          document.getElementById('form1').classList.add('hidden');
          document.getElementById('form2').classList.remove('hidden');
          showMessage('Step 1: успешно. Введите данные для шага 2.');
        } else {
          setBackgroundColor('#6b0b0b'); // красный оттенок
          showMessage('Step 1: неверный логин или пароль.');
        }
      });

      // Step 2
      document.getElementById('btn2').addEventListener('click', async()=>{
        const l = document.getElementById('login2').value.trim();
        const p = document.getElementById('pass2').value;
        const ok = await verifyStep(l,p,EXPECTED.step2);
        if(ok){
          setBackgroundColor('#0b612a');
          document.getElementById('form2').classList.add('hidden');
          document.getElementById('form3').classList.remove('hidden');
          showMessage('Step 2: успешно. Последний шаг.');
        } else {
          setBackgroundColor('#6b0b0b');
          showMessage('Step 2: неверный логин или пароль.');
        }
      });

      // Step 3
      document.getElementById('btn3').addEventListener('click', async()=>{
        const l = document.getElementById('login3').value.trim();
        const p = document.getElementById('pass3').value;
        const ok = await verifyStep(l,p,EXPECTED.step3);
        if(ok){
          // Всё успешно — показываем финальную страницу с чёрным дизайном
          document.getElementById('stage').innerHTML = `
            <div class="final-page">
              <div class="welcome">Welcome!</div>
              <div class="subtitle">Добро пожаловать — доступ разрешён.</div>
            </div>`;
          document.body.style.background = '#000';
        } else {
          setBackgroundColor('#6b0b0b');
          showMessage('Step 3: неверный логин или пароль.');
        }
      });

    })();
  </script>
</body>
</html>
