<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Elka Mods — Synced Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
    body { font-family: 'Montserrat', sans-serif; background:#000; color:#fff; }
    .custom-border { border:1px solid #333; border-radius:8px; transition:all .3s ease; }
    .custom-border:hover{ border-color:#555; }
    .password-input{ background:#111; border:1px solid #333; }
    .note-card{ background:#111; border:1px solid #333; transition:all .3s ease; }
    .note-card:hover{ border-color:#555; }
    .btn{ background:#222; transition:all .3s ease; }
    .btn:hover{ background:#333; }
    .disabled { opacity: .5; pointer-events: none; }
  </style>
</head>
<body class="min-h-screen relative">
  <div id="main-content" class="min-h-screen flex flex-col justify-center items-center px-4 py-20">
    <h1 id="welcome-text" class="text-4xl md:text-6xl font-bold mb-10 text-center opacity-0">Welcome to Elka Mods</h1>
    <div id="secret-man" class="fixed top-5 right-5 cursor-pointer z-50">
      <i data-feather="user" class="w-10 h-10 text-white"></i>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
    <div class="bg-black custom-border p-8 max-w-md w-full">
      <h2 class="text-2xl font-bold mb-6 text-center">Admin Login</h2>
      <div class="space-y-4">
        <div><label class="block text-sm font-medium mb-2">Username</label><input type="text" id="username" class="w-full px-4 py-2 rounded password-input custom-border" placeholder="Enter username"></div>
        <div><label class="block text-sm font-medium mb-2">Password</label><input type="password" id="password" class="w-full px-4 py-2 rounded password-input custom-border" placeholder="Enter password"></div>
        <button id="login-btn" class="w-full btn text-white py-2 px-4 rounded">Enter Secret Panel</button>
        <p id="login-error" class="text-red-500 text-sm text-center hidden">Invalid credentials!</p>
        <p id="login-block" class="text-yellow-500 text-sm text-center hidden">Too many failed attempts. Try again later.</p>
      </div>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" class="min-h-screen hidden bg-black px-4 py-20">
    <div class="max-w-4xl mx-auto">
      <div class="flex items-center justify-between mb-8">
        <h1 id="admin-title" class="text-4xl md:text-6xl font-bold opacity-0">Admin Panel</h1>
        <div>
          <button id="logout-btn" class="btn text-white py-2 px-4 rounded mr-2 hidden">Выйти</button>
          <span id="sync-status" class="text-sm text-gray-400">offline</span>
        </div>
      </div>

      <div class="mt-12">
        <h2 class="text-2xl font-bold mb-6">Your Notes (синхронизировано)</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" id="notes-container"></div>

        <div class="bg-black custom-border p-6">
          <h3 class="text-xl font-bold mb-4">Add New Note</h3>
          <div class="space-y-4">
            <div><input type="text" id="note-title" class="w-full px-4 py-2 rounded bg-black custom-border" placeholder="Title"></div>
            <div><textarea id="note-content" rows="4" class="w-full px-4 py-2 rounded bg-black custom-border" placeholder="Your note content..."></textarea></div>
            <button id="add-note-btn" class="btn text-white py-2 px-6 rounded">Save Note</button>
            <p id="auth-required" class="text-yellow-400 text-sm hidden">Только для авторизованных админов.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    feather.replace();

    (async function(){
      const PLAINTEXT_USERNAME = "adminuser333";
      const PLAINTEXT_PASSWORD = "ADHBTN446L9K0";

      function setCookie(name, value, minutes) {
        const expires = new Date(Date.now() + minutes * 60000).toUTCString();
        document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
      }
      function getCookie(name) {
        const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return match ? decodeURIComponent(match[2]) : null;
      }
      function deleteCookie(name) { document.cookie = name + '=; Max-Age=0; path=/'; }

      let failedAttempts = Number(localStorage.getItem("failedAttempts") || 0);
      let blockUntil = Number(localStorage.getItem("blockUntil") || 0);
      function isBlocked() {
        const now = Date.now();
        if (now < blockUntil) return true;
        if (blockUntil && now >= blockUntil) {
          localStorage.removeItem("blockUntil");
          localStorage.setItem("failedAttempts", "0");
          failedAttempts = 0;
          blockUntil = 0;
        }
        return false;
      }

      function showBlockUI() {
        document.getElementById("login-block").classList.remove("hidden");
        document.getElementById("login-error").classList.add("hidden");
      }

      function onLoginSuccessLocalActions() {
        deleteCookie("blocked");
        localStorage.removeItem("failedAttempts");
        localStorage.removeItem("blockUntil");
        setCookie("loggedIn", "true", 60 * 24);
        document.getElementById("logout-btn").classList.remove("hidden");
        closeLoginModal();
      }
      function onLoginFailLocalActions() {
        failedAttempts++;
        localStorage.setItem("failedAttempts", failedAttempts);
        if (failedAttempts >= 3) {
          const lockUntil = Date.now() + 15 * 60 * 1000;
          localStorage.setItem("blockUntil", lockUntil);
          blockUntil = lockUntil;
          setCookie("blocked", "true", 15);
          showBlockUI();
        } else {
          document.getElementById("login-error").classList.remove("hidden");
        }
      }

      function closeLoginModal(){ 
        anime({ targets: '#login-modal', opacity: [1,0], duration: 300, complete: ()=> {
          document.getElementById('login-modal').classList.add('hidden');
          document.getElementById('main-content').classList.add('hidden');
          document.getElementById('admin-panel').classList.remove('hidden');
          anime({ targets:'#admin-title', opacity:[0,1], translateY:[-50,0], duration:1500, easing:'easeOutExpo' });
        }});
      }

      // ✅ Твой Firebase конфиг вставлен сюда:
      const FIREBASE_CONFIG = {
        apiKey: "AIzaSyBzXIYzKAOPswueY1vfjBPXxsbCEzs2xtw",
        authDomain: "coffee-spark-ai-barista-ce191.firebaseapp.com",
        databaseURL: "https://coffee-spark-ai-barista-ce191-default-rtdb.firebaseio.com",
        projectId: "coffee-spark-ai-barista-ce191",
        storageBucket: "coffee-spark-ai-barista-ce191.firebasestorage.app",
        messagingSenderId: "241627491369",
        appId: "1:241627491369:web:3f4efef6f5ff5bc1b10038"
      };

      firebase.initializeApp(FIREBASE_CONFIG);
      const db = firebase.database();
      const notesRef = db.ref('elka-notes');

      let localNotes = {};
      const notesContainer = () => document.getElementById('notes-container');
      const syncStatusEl = document.getElementById('sync-status');

      function renderNotesFromMap(map) {
        const container = notesContainer();
        container.innerHTML = '';
        const entries = Object.entries(map).sort((a,b)=> (b[1].ts||0) - (a[1].ts||0));
        entries.forEach(([key, note])=>{
          const div = document.createElement('div');
          div.className = 'note-card rounded-lg p-6';
          div.innerHTML = `
            <h3 class="text-xl font-bold mb-2">${note.title||''}</h3>
            <p class="text-gray-300 mb-4">${note.content||''}</p>
            <div class="flex justify-between items-center">
              <small class="text-xs text-gray-500">${note.ts ? new Date(note.ts).toLocaleString() : ''}</small>
              <button data-id="${key}" class="delete-note text-red-500 hover:text-red-400 transition mr-2">
                <i data-feather="trash-2"></i>
              </button>
            </div>`;
          container.appendChild(div);
        });
        feather.replace();
        document.querySelectorAll('.delete-note').forEach(btn=>{
          btn.addEventListener('click',(ev)=>{
            const id = ev.currentTarget.getAttribute('data-id');
            attemptDeleteNote(id);
          });
        });
      }

      notesRef.on('value', snapshot=>{
        localNotes = snapshot.val() || {};
        renderNotesFromMap(localNotes);
        syncStatusEl.textContent = 'synced';
      });

      async function attemptAddNote() {
        const title = document.getElementById('note-title').value.trim();
        const content = document.getElementById('note-content').value.trim();
        if (!title || !content) return;
        if (getCookie('loggedIn') !== 'true') {
          document.getElementById('auth-required').classList.remove('hidden');
          return;
        }
        const note = { title, content, ts: Date.now() };
        await notesRef.push(note);
        document.getElementById('note-title').value = '';
        document.getElementById('note-content').value = '';
      }

      async function attemptDeleteNote(id) {
        if (getCookie('loggedIn') !== 'true') {
          document.getElementById('auth-required').classList.remove('hidden');
          return;
        }
        await db.ref('elka-notes/' + id).remove();
      }

      document.addEventListener('DOMContentLoaded', ()=>{
        anime({targets:'#welcome-text', opacity:[0,1], translateY:[-100,0], duration:1500, easing:'easeOutExpo'});
        if (getCookie('loggedIn') === 'true') {
          document.getElementById('logout-btn').classList.remove('hidden');
        }
        document.getElementById('secret-man').addEventListener('click', ()=>{
          if (isBlocked() || getCookie('blocked') === 'true') {
            document.getElementById('login-block').classList.remove('hidden');
            return;
          }
          document.getElementById('login-modal').classList.remove('hidden');
          anime({targets:'#login-modal', opacity:[0,1], duration:500});
        });

        document.getElementById('login-btn').addEventListener('click', ()=>{
          if (isBlocked() || getCookie('blocked') === 'true') {
            document.getElementById('login-block').classList.remove('hidden');
            return;
          }
          const username = document.getElementById('username').value.trim();
          const password = document.getElementById('password').value.trim();
          if (username === PLAINTEXT_USERNAME && password === PLAINTEXT_PASSWORD) {
            onLoginSuccessLocalActions();
          } else {
            onLoginFailLocalActions();
          }
        });

        document.getElementById('add-note-btn').addEventListener('click', attemptAddNote);
        document.getElementById('logout-btn').addEventListener('click', ()=>{
          deleteCookie('loggedIn');
          document.getElementById('logout-btn').classList.add('hidden');
          document.getElementById('admin-panel').classList.add('hidden');
          document.getElementById('main-content').classList.remove('hidden');
        });

        if (getCookie('loggedIn') === 'true') {
          document.getElementById('main-content').classList.add('hidden');
          document.getElementById('admin-panel').classList.remove('hidden');
          anime({ targets:'#admin-title', opacity:[0,1], translateY:[-50,0], duration:1500, easing:'easeOutExpo' });
        }
      });
    })();
  </script>
</body>
</html>
